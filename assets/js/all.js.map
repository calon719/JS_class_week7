{"version":3,"sources":["all.js"],"names":["form","document","querySelector","addTicketInputs","querySelectorAll","addTicketBtn","cardList","searchAreaInput","searchResultNum","ticketData","areaChartData","addEventListener","checkInput","areaFilter","forEach","item","e","keyCode","preventDefault","axios","get","then","response","data","renderData","updateChart","error","console","log","undefined","type","nextElementSibling","setAttribute","constraints","name","presence","message","imgUrl","url","schemes","area","price","numericality","greaterThan","group","rate","lessThanOrEqualTo","description","length","maximum","errors","validate","Object","keys","key","el","classToggle","getAttribute","classList","toggle","innerHTML","addTicket","obj","id","parseInt","value","push","inputValue","searchResultData","filter","str","resultNum","textContent","splice","areaData","aryCheck","some","itemCheck","num","aryItem","ary","chart","c3","generate","bindto","columns","donut","title","width","label","show","size","height"],"mappings":"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","file":"all.js","sourcesContent":["const form = document.querySelector('.addTicket-form');\nconst addTicketInputs = document.querySelectorAll('[data-prop=\"ticketInput\"]');\nconst addTicketBtn = document.querySelector('#addTicketBtn');\nconst cardList = document.querySelector('.ticketList');\nconst searchAreaInput = document.querySelector('.searchRegion');\nconst searchResultNum = document.querySelector('.searchResultNum');\n\n// 資料\nlet ticketData;\nlet areaChartData = [];\n\n// 事件\naddTicketBtn.addEventListener('click', checkInput);\nsearchAreaInput.addEventListener('change', areaFilter);\naddTicketInputs.forEach(function (item) {\n  item.addEventListener('keydown', function (e) {\n    if (e.keyCode == 13) {\n      e.preventDefault();\n      checkInput();\n    }\n  });\n});\n\n\naxios.get('https://raw.githubusercontent.com/hexschool/js-training/main/travelApi.json').then(function (response) {\n  ticketData = response.data.data;\n  renderData(ticketData);\n  updateChart(ticketData);\n}).catch(function (error) {\n  console.log(error);\n});\n\nfunction checkInput(e) {\n  if (e != undefined && e.type == 'click') {\n    e.preventDefault();\n  };\n\n  addTicketInputs.forEach(function (item) {\n    item.nextElementSibling.setAttribute('class', 'invisible text-danger text-tiny mb-0.5');\n  });\n\n  let constraints = {\n    name: {\n      presence: {\n        message: '^必填'\n      }\n    },\n    imgUrl: {\n      presence: {\n        message: '^必填'\n      },\n      url: {\n        schemes: ['http', 'https'],\n        message: '^不是正確的網址'\n      }\n    },\n    area: {\n      presence: {\n        message: '^必填'\n      }\n    },\n    price: {\n      presence: {\n        message: '^必填'\n      },\n      numericality: {\n        greaterThan: 0,\n        message: '^金額必須大於 0'\n      }\n    },\n    group: {\n      presence: {\n        message: '^必填'\n      },\n      numericality: {\n        greaterThan: 0,\n        message: '^數量必須大於 0'\n      }\n    },\n    rate: {\n      presence: {\n        message: '^必填'\n      },\n      numericality: {\n        greaterThan: 0,\n        lessThanOrEqualTo: 10,\n        message: '^星級為 1 - 10 分'\n      }\n    },\n    description: {\n      presence: {\n        message: '^必填'\n      },\n      length: {\n        maximum: 100,\n        message: '^字數不可以超過 100 字'\n      }\n    }\n  };\n\n  let errors = validate(form, constraints);\n\n  if (errors) {\n    Object.keys(errors).forEach(function (key) {\n      let el = document.querySelector(`[data-ticketInput=\"${key}\"]`);\n      let classToggle = el.getAttribute('data-class-toggle');\n\n      el.classList.toggle(classToggle);\n      el.innerHTML = `<i class=\"fas fa-exclamation-circle mr-1\"></i>${errors[key]}`;\n    });\n  } else {\n    addTicket();\n  };\n};\n\n// 新增資料到 物件 ticketData\nfunction addTicket() {\n  let obj = {};\n\n  addTicketInputs.forEach(function (item) {\n    obj.id = ticketData.length;\n    if (item.getAttribute('type') === 'number') {\n      obj[item.getAttribute('name')] = parseInt(item.value);\n    } else {\n      obj[item.getAttribute('name')] = item.value;\n    };\n    item.value = '';\n  });\n  ticketData.push(obj);\n  searchAreaInput.value = '全部';\n  areaFilter(); // 更新畫面\n  updateChart(ticketData); // 更新圖表\n};\n\n// 篩選資料\n// 篩選後會顯示『搜尋資料為 ? 筆』\nfunction areaFilter() {\n  let inputValue = searchAreaInput.value;\n  let searchResultData;\n\n  if (inputValue === '' || inputValue === '全部') {\n    searchResultData = ticketData;\n  } else {\n    searchResultData = ticketData.filter(function (item) {\n      return item.area === inputValue;\n    });\n  };\n  renderData(searchResultData);\n};\n\n// 組裝字串、渲染畫面\nfunction renderData(data) {\n  let str = '';\n  let resultNum = 0;\n  data.forEach(function (item) {\n    resultNum++;\n    str += `\n      <li class=\"flex flex-col bg-white transform hover:scale-105 transition-all duration-700 ease-out rounded relative shadow\">\n        <div class=\"bg-secondary text-white text-xl rounded-r py-2 px-5 absolute -top-5 left-0\">${item.area}</div>\n        <div class=\"h-45 bg-no-repeat bg-cover bg-center rounded-t\"style=\"background-image: url('${item.imgUrl}');\"></div>\n        <div class=\"relative text-primary pt-5 pb-4 px-5 flex flex-grow flex-col justify-between\">\n          <div class=\"absolute bg-primary text-white w-10 text-center rounded-r py-1 -top-4 left-0\">${item.rate}</div>\n          <div>\n            <h2 class=\"font-bold text-2xl pb-1 mb-4 border-b-2\">${item.name}</h2>\n            <p class=\"text-gray-500 mb-8 break-words\">${item.description}</p>\n          </div>\n          <div class=\"flex justify-between items-center\">\n            <p><i class=\"fas fa-exclamation-circle\"></i><span class=\"font-medium\">剩下最後 ${item.group} 組</span></p>\n            <p class=\"font-medium flex items-center\">TWD<span class=\"text-4xl ml-1\">$${item.price}</span></p>\n          </div>\n        </div>\n      </li>\n    `;\n  });\n  cardList.innerHTML = str;\n  searchResultNum.textContent = resultNum;\n};\n\n\n// 更新 donut chart\nfunction updateChart(data) {\n  areaChartData.splice(0)\n  let areaData = [];\n\n  data.forEach(function (item) {\n    let obj = {};\n    let aryCheck = areaData.some(function (itemCheck) { return itemCheck.area === item.area });\n    if (areaData.length === 0 || !aryCheck) {\n      obj.area = item.area;\n      obj.num = 1;\n      areaData.push(obj);\n    } else {\n      areaData.forEach(function (aryItem) {\n        if (aryItem.area === item.area) {\n          aryItem.num += 1;\n        };\n      });\n    };\n  });\n\n  areaData.forEach(function (item) {\n    let ary = [];\n    ary.push(item.area, item.num)\n    areaChartData.push(ary);\n  });\n\n  let chart = c3.generate({\n    bindto: '.areaChart',\n    data: {\n      columns: areaChartData,\n      type: 'donut'\n    },\n    donut: {\n      title: '套票地區比重',\n      width: 10,\n      label: {\n        show: false\n      }\n    },\n    size: {\n      height: 180,\n      width: 160\n    },\n  });\n}\n\n"]}